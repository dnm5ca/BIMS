---
title: "Essential Statistics Homework"
author: "Marieke K Jones, PhD"
date: '2019-01-04'
output:
  html_document:
    keep_md: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE, cache=TRUE)
```

(_Refer back to the Essential Statistics lesson if needed)._

## Key Concepts

> 
- Descriptive statistics
- Hypothesis testing
- Choosing the correct test
- Assumptions
- Cross tabulation
- Interpreting ANOVA and LM output


The dataset we'll be using for this assignment is both curated and hosted by the [Vanderbilt Department of Biostatistics](http://biostat.mc.vanderbilt.edu/wiki/Main/DataSets). Download and read in the **stressEcho.csv** dataset.

## Stress Tests

Dobutamine is a drug that is used during echocardiograms (aka "stress tests"), which are clinical tests used to estimate heart function. The treatment causes heart rate to increase, and its effects at different dosages were measured in a [study published in 1999](https://www.ncbi.nlm.nih.gov/pubmed/10080472). We'll be using the data behind this paper to answer the questions that follow. 

```{r, echo=FALSE}
# Load libraries
library(tidyverse)
# Read data
stress <- read_csv("stressEcho.csv")
# Take a look
stress
```


Note that in addition to measuring dobutamine dosages during each stress test, the authors collected information on other variables including: resting heart rate, max heart rate, blood pressure, age, and (most importantly) whether or not the patient experienced any cardiac event in the 12 months that followed the test.

*Before answering the questions, make sure to review the data dictionary*: 

http://biostat.mc.vanderbilt.edu/wiki/pub/Main/DataSets/stressEcho.html

*Note that the data were originally coded by the authors of the study but were then partially recoded when curated. Pay particular attention to the `any.event` variable (did the subject experience any cardiac event over 12 months following the stress test), which should be interpeted as 0=NO, 1=YES. The top of the data dicionary makes it clear that all event variables are now coded such that 0=NO and 1=YES, which is more conventional.*

## 1. How many people had a cariac event over 12 months following the stress test? What percentage is that?

```{r, echo=FALSE}
table(stress$any.event)
sum(stress[stress$any.event] == 1) / nrow(stress)
```

## 2. What is the highest double product on the maximum dose of Dobutamine (`dpmaxdo`)?

```{r, echo=FALSE}
max(stress$dpmaxdo)
```

## 3. What is the cutoff for the 99th percentile for the highest double product on the maximum dose of Dobutamine (`dpmaxdo`)? 

**HINT**: The `quantile()` function defaults to 0, 0.25, .5, .75 and 1 but can accept arbitrary threshholds. See `?quantile` and look for the `probs` argument.

```{r, echo=FALSE}
quantile(stress$dpmaxdo, probs = 0.99)
```

## 4. Use **ggplot2** to create density plots showing the distribution of the `dpmaxdo` values filled in by whether the person experienced any cardiac event in the past 12 months (`any.event`).

```{r, echo=FALSE}
ggplot(stress, aes(dpmaxdo)) +
  geom_density(aes(fill = as.factor(any.event)), alpha = .5)
```

## 5. The plot above indicates that the distributions are approximately normal, with the except of a few outliers in the right tail. With the normality assumption satisfied, perform a two sample t-test to compare the mean double product max values between those who did or did not experience any cardiac event (`any.event`). Assume equal variances between these groups.

```{r, echo=FALSE}
t.test(dpmaxdo ~ any.event, data = stress, var.equal = TRUE)
```

## 6. Interpret the output from the test above taking into account what the authors concluded. What questions do you have about their results compared to yours?

## 7. The smoking history column (`hxofCig`) is represented categorically as "heavy", "moderate" and "non-smoker". Create a table showing the frequency of individuals in each smoking history category, for all individuals who either did or did not have any cardiac event. Next, show proportions over the row margin (what percentage of each category had any cardiac event?).

```{r, echo=FALSE}
xt <- xtabs(~ hxofCig + any.event, data = stress)
xt
round(prop.table(xt, margin=1), 3)
```

## 8. Create a mosaic plot to explore the tabulated counts visually.

```{r, echo=FALSE}
mosaicplot(xt)
```

## 9. Now use a chi-squared test of independence to assess the relationship between smoking history and a cardiac event.

```{r, echo=FALSE}
chisq.test(xt)
```

## 10. Interpret the output above.